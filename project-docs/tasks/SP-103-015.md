# Task SP-103-015: Remaining Arithmetic

**Created:** 2026-01-25
**Status:** Pending
**Priority:** MEDIUM (Arithmetic)
**Estimated Impact:** +0.5% (estimated 5 tests)

## Description

Fix remaining arithmetic operator edge cases.

## Failing Tests (estimated)

### Primary Issues:
1. **Division**: Edge cases in division operations
2. **Modulo**: Modulo operation edge cases
3. **Operator Precedence**: Complex expressions with multiple operators
4. **Overflow**: Numeric overflow handling

## Root Cause Analysis

Arithmetic operators may have edge cases not handled.

## Implementation Plan

### Step 1: Review Arithmetic Operators
**File:** `fhir4ds/fhirpath/sql/translators/operator_translator.py`

Review all arithmetic operators: +, -, *, /, mod, div

### Step 2: Fix Edge Cases
Fix edge cases in:
- Division by zero
- Modulo operations
- Operator precedence
- Type coercion in arithmetic

### Step 3: Update SQL Generation
Generate proper SQL for arithmetic operations.

## Testing Strategy

1. **Unit Tests:**
   - Test all arithmetic operators
   - Test edge cases

2. **Compliance Tests:**
   - Run: `python3 run_baseline_compliance.py`
   - Verify additional tests pass

3. **Database Parity:**
   - Test on DuckDB
   - Validate PostgreSQL SQL generation

## Acceptance Criteria

- [ ] All remaining arithmetic tests pass
- [ ] No existing tests break
- [ ] Dual-database parity maintained
- [ ] Code follows unified FHIRPath architecture

## Dependencies

SP-103-005 (Simple Arithmetic)

## Branch

`git checkout -b SP-103-015-remaining-arithmetic`

## Commit Message

```
feat(SP-103-015): Remaining arithmetic fixes (Task: SP-103-015)

- Fix division edge cases
- Fix modulo operations
- Fix operator precedence
- Improve type coercion in arithmetic

Fixes failing tests in official FHIRPath compliance suite.
```
