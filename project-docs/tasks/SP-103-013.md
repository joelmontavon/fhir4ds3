# Task SP-103-013: Collection Functions - Edge Cases

**Created:** 2026-01-25
**Status:** Pending
**Priority:** MEDIUM (Collections)
**Estimated Impact:** +0.5% (estimated 5 tests)

## Description

Fix edge cases in collection functions.

## Failing Tests (estimated)

### Primary Issues:
1. **Empty Collections**: Edge cases with empty input
2. **Single Item Collections**: Edge cases with single item
3. **Null Values**: Edge cases with null values in collections

## Root Cause Analysis

Edge case handling in collection functions may be incomplete.

## Implementation Plan

### Step 1: Review Edge Case Handling
**File:** `fhir4ds/fhirpath/sql/translators/function_translator.py`

Review edge case handling in all collection functions.

### Step 2: Fix Edge Cases
Ensure proper handling of:
- Empty collections
- Single item collections
- Null values in collections
- Boundary conditions

### Step 3: Update SQL Generation
Generate proper SQL for edge cases.

## Testing Strategy

1. **Unit Tests:**
   - Test edge cases for all collection functions
   - Test boundary conditions

2. **Compliance Tests:**
   - Run: `python3 run_baseline_compliance.py`
   - Verify additional tests pass

3. **Database Parity:**
   - Test on DuckDB
   - Validate PostgreSQL SQL generation

## Acceptance Criteria

- [ ] All edge case tests pass
- [ ] No existing tests break
- [ ] Dual-database parity maintained
- [ ] Code follows unified FHIRPath architecture

## Dependencies

SP-103-011, SP-103-012

## Branch

`git checkout -b SP-103-013-collection-edge-cases`

## Commit Message

```
feat(SP-103-013): Collection function edge cases (Task: SP-103-013)

- Fix edge cases in collection functions
- Handle empty collections properly
- Handle single item collections properly
- Handle null values in collections properly

Fixes failing tests in official FHIRPath compliance suite.
```
