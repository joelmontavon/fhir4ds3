# Task SP-103-010: Comparison Operators - Empty Collections

**Created:** 2026-01-25
**Status:** Pending
**Priority:** MEDIUM (Comparisons)
**Estimated Impact:** +2.1% (estimated 20 tests)

## Description

Fix comparison operators when dealing with empty collections.

## Failing Tests (estimated)

### Primary Issues:
1. **Empty Collection Comparisons**: empty = empty, empty = value
2. **Singleton vs Collection**: Comparing single values with collections
3. **Empty Collection in Expressions**: Proper handling throughout

## Root Cause Analysis

Empty collection handling in comparisons may be incomplete.

## Implementation Plan

### Step 1: Review Empty Collection Logic
**File:** `fhir4ds/fhirpath/sql/translators/operator_translator.py`

Review how empty collections are handled.

### Step 2: Implement FHIRPath Semantics
- empty = empty → true
- empty = non-empty → false
- empty != empty → false
- empty != non-empty → true

### Step 3: Update SQL Generation
Generate proper SQL for empty collection comparisons.

## Testing Strategy

1. **Unit Tests:**
   - Test empty collection comparisons
   - Test singleton vs collection
   - Test edge cases

2. **Compliance Tests:**
   - Run: `python3 run_baseline_compliance.py`
   - Verify additional tests pass

3. **Database Parity:**
   - Test on DuckDB
   - Validate PostgreSQL SQL generation

## Acceptance Criteria

- [ ] All empty collection comparison tests pass
- [ ] No existing tests break
- [ ] Dual-database parity maintained
- [ ] Code follows unified FHIRPath architecture

## Dependencies

SP-103-009 (Comparison Type Coercion)

## Branch

`git checkout -b SP-103-010-comparison-empty-collections`

## Commit Message

```
feat(SP-103-010): Empty collection comparisons (Task: SP-103-010)

- Fix comparison operators with empty collections
- Implement proper singleton vs collection comparisons
- Update SQL generation for empty collections

Fixes failing tests in official FHIRPath compliance suite.
```
