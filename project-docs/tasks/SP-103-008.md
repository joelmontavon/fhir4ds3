# Task SP-103-008: Type Checking - as()/ofType()

**Created:** 2026-01-25
**Status:** Pending
**Priority:** HIGH (Type System)
**Estimated Impact:** +0.5% (estimated)

## Description

Implement as() and ofType() type checking operators.

## Failing Tests (estimated)

### Primary Issues:
1. **as() Operator**: Type casting/conversion operator
2. **ofType() Operator**: Filter collection by type
3. **Type Conversion**: Proper type handling in as()
4. **Type Filtering**: Proper collection filtering in ofType()

## Root Cause Analysis

as() and ofType() operators may not be fully implemented.

## Implementation Plan

### Step 1: Implement as() Operator
**File:** `fhir4ds/fhirpath/operators/type_operators.py`

as() should:
- Convert value to specified type if possible
- Return null if conversion not possible
- Handle polymorphic types

### Step 2: Implement ofType() Operator
ofType() should:
- Filter collection to only items of specified type
- Return empty collection if no matches
- Handle type inheritance

### Step 3: Update SQL Generation
Generate proper SQL for type operations.

## Testing Strategy

1. **Unit Tests:**
   - Test as() operator
   - Test ofType() operator
   - Test edge cases

2. **Compliance Tests:**
   - Run: `python3 run_baseline_compliance.py`
   - Verify additional tests pass

3. **Database Parity:**
   - Test on DuckDB
   - Validate PostgreSQL SQL generation

## Acceptance Criteria

- [ ] All as()/ofType() tests pass
- [ ] No existing tests break
- [ ] Dual-database parity maintained
- [ ] Code follows unified FHIRPath architecture

## Dependencies

SP-103-007 (is() operator)

## Branch

`git checkout -b SP-103-008-as-ofType-operators`

## Commit Message

```
feat(SP-103-008): as() and ofType() type operators (Task: SP-103-008)

- Implement as() type conversion operator
- Implement ofType() type filtering operator
- Add proper type handling logic
- Update SQL generation for type operations

Fixes failing tests in official FHIRPath compliance suite.
```
