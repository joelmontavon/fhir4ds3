# Task SP-103-004: Semantic Validation

**Created:** 2026-01-25
**Status:** Pending
**Priority:** HIGH (Quick Win)
**Estimated Impact:** +0.2% (2 tests)

## Description

Fix semantic validation to properly reject invalid expressions.

## Failing Tests (2 tests)

### Primary Issues:
1. **Incomplete Expressions**: Expressions ending with operators should be rejected
2. **Unterminated Comments**: Block comments not properly closed

### Sample Failures:
- `testComment7`: `2 + 2 /` (should fail semantic validation)
- `testComment8`: `2 + 2 /* not finished` (should fail parse validation)

## Root Cause Analysis

Current implementation:
1. Incomplete expression validation may be too strict or incorrect
2. Comment validation already working but may need adjustments

## Implementation Plan

### Step 1: Review Current Validation
**File:** `fhir4ds/fhirpath/parser_core/semantic_validator.py`

Review `_validate_incomplete_expressions()` method.

### Step 2: Fix Validation Logic
Ensure proper rejection of:
- Expressions ending with binary operators
- Expressions ending with unary operators
- Any incomplete expression syntax

### Step 3: Test Edge Cases
- Valid expressions that look incomplete
- Invalid expressions that should be rejected

## Testing Strategy

1. **Unit Tests:**
   - Test semantic validation
   - Test edge cases

2. **Compliance Tests:**
   - Run: `python3 run_baseline_compliance.py`
   - Verify 2 additional tests pass

3. **Database Parity:**
   - N/A (parse-time validation)

## Acceptance Criteria

- [ ] All 2 semantic validation tests pass
- [ ] No existing tests break
- [ ] Code follows unified FHIRPath architecture

## Dependencies

None (Quick Win)

## Branch

`git checkout -b SP-103-004-semantic-validation`

## Commit Message

```
feat(SP-103-004): Semantic validation fixes (Task: SP-103-004)

- Fix incomplete expression validation
- Ensure proper rejection of invalid expressions
- Adjust validation edge cases

Fixes 2 failing tests in official FHIRPath compliance suite.
```
